<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API各个目录文件功能 | Young-Site</title>
    <meta name="description" content="知行合一">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style._ghybU1n.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CNkXtUq4.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.mObu-SpH.js">
    <link rel="modulepreload" href="/assets/chunks/framework.B-XtCDNB.js">
    <link rel="modulepreload" href="/assets/Dify_API各个目录文件功能.md.zOWkhAfu.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-4813dc16><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c7c7d332></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c7c7d332>Skip to content</a><!--]--><!----><header class="VPNav" data-v-4813dc16 data-v-22c67d4f><div class="VPNavBar" data-v-22c67d4f data-v-438b78f0><div class="wrapper" data-v-438b78f0><div class="container" data-v-438b78f0><div class="title" data-v-438b78f0><div class="VPNavBarTitle has-sidebar" data-v-438b78f0 data-v-86e180a2><a class="title" href="/" data-v-86e180a2><!--[--><!--]--><!--[--><img class="VPImage logo" src="/public/logo.jpeg" alt data-v-70e880b9><!--]--><span data-v-86e180a2>Young-Blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-438b78f0><div class="content-body" data-v-438b78f0><!--[--><!--]--><div class="VPNavBarSearch search" data-v-438b78f0><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-438b78f0 data-v-88d68326><span id="main-nav-aria-label" class="visually-hidden" data-v-88d68326> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Python/%E8%BF%AD%E4%BB%A3.html" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>Python</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Database/Redis%E5%85%A5%E9%97%A8.html" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>数据库</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/MicroService/gRPC%E5%85%A5%E9%97%A8.html" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>微服务</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/DevOps/%E5%85%A5%E9%97%A8.html" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>DevOps</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Dify/Dify.html" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>Dify</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-438b78f0 data-v-039e315e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-039e315e data-v-d16b7b8a data-v-b7e5a6d9><span class="check" data-v-b7e5a6d9><span class="icon" data-v-b7e5a6d9><!--[--><span class="vpi-sun sun" data-v-d16b7b8a></span><span class="vpi-moon moon" data-v-d16b7b8a></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-438b78f0 data-v-1fb4275b data-v-4594f90c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zy30651" aria-label="github" target="_blank" rel="noopener" data-v-4594f90c data-v-9d5268b0><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-438b78f0 data-v-15ce5b99 data-v-4b10ab9f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-4b10ab9f><span class="vpi-more-horizontal icon" data-v-4b10ab9f></span></button><div class="menu" data-v-4b10ab9f><div class="VPMenu" data-v-4b10ab9f data-v-18661181><!----><!--[--><!--[--><!----><div class="group" data-v-15ce5b99><div class="item appearance" data-v-15ce5b99><p class="label" data-v-15ce5b99>Appearance</p><div class="appearance-action" data-v-15ce5b99><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-15ce5b99 data-v-d16b7b8a data-v-b7e5a6d9><span class="check" data-v-b7e5a6d9><span class="icon" data-v-b7e5a6d9><!--[--><span class="vpi-sun sun" data-v-d16b7b8a></span><span class="vpi-moon moon" data-v-d16b7b8a></span><!--]--></span></span></button></div></div></div><div class="group" data-v-15ce5b99><div class="item social-links" data-v-15ce5b99><div class="VPSocialLinks social-links-list" data-v-15ce5b99 data-v-4594f90c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zy30651" aria-label="github" target="_blank" rel="noopener" data-v-4594f90c data-v-9d5268b0><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-438b78f0 data-v-1d2167b6><span class="container" data-v-1d2167b6><span class="top" data-v-1d2167b6></span><span class="middle" data-v-1d2167b6></span><span class="bottom" data-v-1d2167b6></span></span></button></div></div></div></div><div class="divider" data-v-438b78f0><div class="divider-line" data-v-438b78f0></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-4813dc16 data-v-1dad4ac0><div class="container" data-v-1dad4ac0><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-1dad4ac0><span class="vpi-align-left menu-icon" data-v-1dad4ac0></span><span class="menu-text" data-v-1dad4ac0>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-1dad4ac0 data-v-f4ff6604><button data-v-f4ff6604>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-4813dc16 data-v-2cffcfb5><div class="curtain" data-v-2cffcfb5></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-2cffcfb5><span class="visually-hidden" id="sidebar-aria-label" data-v-2cffcfb5> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-ad0e979a><section class="VPSidebarItem level-0 has-active" data-v-ad0e979a data-v-35fdcd38><div class="item" role="button" tabindex="0" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><h2 class="text" data-v-35fdcd38>Dify</h2><!----></div><div class="items" data-v-35fdcd38><!--[--><div class="VPSidebarItem level-1 is-link" data-v-35fdcd38 data-v-35fdcd38><div class="item" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><a class="VPLink link link" href="/Dify/Dify.html" data-v-35fdcd38><!--[--><p class="text" data-v-35fdcd38>Dify入门</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-35fdcd38 data-v-35fdcd38><div class="item" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><a class="VPLink link link" href="/Dify/docker-compose.yml" data-v-35fdcd38><!--[--><p class="text" data-v-35fdcd38>Docker-Compose.yml参数详解</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-35fdcd38 data-v-35fdcd38><div class="item" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><a class="VPLink link link" href="/Dify/API%E5%90%84%E4%B8%AA%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD.html" data-v-35fdcd38><!--[--><p class="text" data-v-35fdcd38>API各个目录文件功能</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-35fdcd38 data-v-35fdcd38><div class="item" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><a class="VPLink link link" href="/Dify/Web%E5%90%84%E4%B8%AA%E7%9B%AE%E5%BD%95%E7%9A%84%E5%8A%9F%E8%83%BD.html" data-v-35fdcd38><!--[--><p class="text" data-v-35fdcd38>Web各个目录的功能</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-35fdcd38 data-v-35fdcd38><div class="item" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><a class="VPLink link link" href="/Dify/Embedding%E6%A8%A1%E5%9E%8B%E5%88%86%E6%AE%B5.html" data-v-35fdcd38><!--[--><p class="text" data-v-35fdcd38>Embedding模型分段</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-35fdcd38 data-v-35fdcd38><div class="item" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><a class="VPLink link link" href="/Dify/%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0.html" data-v-35fdcd38><!--[--><p class="text" data-v-35fdcd38>模型参数</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-4813dc16 data-v-97402932><div class="VPDoc has-sidebar has-aside" data-v-97402932 data-v-28ef3a16><!--[--><!--]--><div class="container" data-v-28ef3a16><div class="aside" data-v-28ef3a16><div class="aside-curtain" data-v-28ef3a16></div><div class="aside-container" data-v-28ef3a16><div class="aside-content" data-v-28ef3a16><div class="VPDocAside" data-v-28ef3a16 data-v-46a306fe><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-46a306fe data-v-56286fd3><div class="content" data-v-56286fd3><div class="outline-marker" data-v-56286fd3></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-56286fd3>On this page</div><ul class="VPDocOutlineItem root" data-v-56286fd3 data-v-c624256b><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-46a306fe></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-28ef3a16><div class="content-container" data-v-28ef3a16><!--[--><!--]--><main class="main" data-v-28ef3a16><div style="position:relative;" class="vp-doc _Dify_API%E5%90%84%E4%B8%AA%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD" data-v-28ef3a16><div><h1 id="api各个目录文件功能" tabindex="-1">API各个目录文件功能 <a class="header-anchor" href="#api各个目录文件功能" aria-label="Permalink to &quot;API各个目录文件功能&quot;">​</a></h1><h3 id="api-目录-后端核心服务-业务逻辑与数据中枢" tabindex="-1"><code>api</code> 目录：后端核心服务（业务逻辑与数据中枢） <a class="header-anchor" href="#api-目录-后端核心服务-业务逻辑与数据中枢" aria-label="Permalink to &quot;`api` 目录：后端核心服务（业务逻辑与数据中枢）&quot;">​</a></h3><p>​<code>api</code>​ 是 Dify 后端的核心代码仓库，负责处理<strong>业务逻辑、模型调用、数据存储、API 服务</strong>等核心能力，是前端和第三方系统的 “数据与逻辑大脑”。</p><p>Dify API 目录结构分析</p><h3 id="🏗️-核心应用文件" tabindex="-1">🏗️ <strong>核心应用文件</strong> <a class="header-anchor" href="#🏗️-核心应用文件" aria-label="Permalink to &quot;🏗️ **核心应用文件**&quot;">​</a></h3><p>• <code>app.py</code>​ - Flask应用入口点，处理gevent配置和应用启动<br> • <code>dify_app.py</code>​ - 自定义Flask应用类<br> • <code>app_factory.py</code>​ - 应用工厂模式，创建Flask应用实例<br> • <code>commands.py</code> - Flask CLI命令定义</p><h3 id="📁-主要目录结构" tabindex="-1">📁 <strong>主要目录结构</strong> <a class="header-anchor" href="#📁-主要目录结构" aria-label="Permalink to &quot;📁 **主要目录结构**&quot;">​</a></h3><h5 id="​core-​-​-核心业务逻辑-733个文件" tabindex="-1"><strong>​<code>core/</code>​</strong> ​ <strong>- 核心业务逻辑</strong> (733个文件) <a class="header-anchor" href="#​core-​-​-核心业务逻辑-733个文件" aria-label="Permalink to &quot;**​`core/`​** ​  **- 核心业务逻辑** (733个文件)&quot;">​</a></h5><p>这是Dify的核心业务逻辑层，包含：</p><hr><blockquote><h4 id="根目录" tabindex="-1">根目录 <a class="header-anchor" href="#根目录" aria-label="Permalink to &quot;根目录&quot;">​</a></h4><ul><li><p><strong>init</strong>.py: 导入moderation模块</p></li><li><p>hosting_configuration.py：托管服务配置管理，支持Azure 、OpenAI、OpenAI、Anthropic等云服务商的配额管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• HostingQuota: 托管配额基类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• TrialHostingQuota: 试用托管配额</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• PaidHostingQuota: 付费托管配额</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• FreeHostingQuota: 免费托管配额</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• HostingProvider: 托管提供商配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• HostedModerationConfig: 托管内容审核配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• HostingConfiguration: 托管配置管理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持Azure OpenAI、OpenAI、Anthropic、Minimax、Spark、ZhipuAI等提供商</span></span></code></pre></div></li><li><p>indexing_runner.py: 文档索引运行器，处理文档的提取、转换和索引构建</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• IndexingRunner: 文档索引处理核心类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• DocumentIsPausedError: 文档暂停错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• DocumentIsDeletedPausedError: 文档删除暂停错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持文档提取、转换、分段、索引加载</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持多种数据源：上传文件、Notion导入、网站爬取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持高质量和经济型两种索引技术</span></span></code></pre></div></li><li><p>model_manager.py: 模型管理器，负责模型实例的创建、调用和负载均衡</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• ModelInstance: 模型实例类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• ModelManager: 模型管理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• LBModelManager: 负载均衡模型管理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持LLM、文本嵌入、重排序、内容审核、语音转文本、TTS等模型类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持负载均衡和轮询调用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持模型令牌计算和流式响应</span></span></code></pre></div></li><li><p>provider_manager.py: 提供商管理器;管理模型提供商的配置、凭证和配额</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• ProviderManager: 提供商管理器核心类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持托管和自定义模型提供商</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持配额管理、凭证加密、负载均衡配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持提供商配置验证和更新</span></span></code></pre></div></li></ul><hr><h4 id="🤖-agent-模块-agent-ai智能体运行框架" tabindex="-1">🤖 <strong>Agent 模块</strong> (<code>agent/</code>)：AI智能体运行框架 <a class="header-anchor" href="#🤖-agent-模块-agent-ai智能体运行框架" aria-label="Permalink to &quot;🤖 **Agent 模块** (`agent/`)：AI智能体运行框架&quot;">​</a></h4><ul><li><h5 id="根目录-1" tabindex="-1">根目录 <a class="header-anchor" href="#根目录-1" aria-label="Permalink to &quot;根目录&quot;">​</a></h5><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">•  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py: 模块初始化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• base_agent_runner.py: 基础智能体运行器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• cot_agent_runner.py: 思维链智能体运行器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• cot_chat_agent_runner.py: 思维链聊天智能体运行器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• cot_completion_agent_runner.py: 思维链补全智能体运行器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• fc_agent_runner.py: 函数调用智能体运行器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• entities.py: 智能体实体定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• plugin_entities.py: 插件实体定义</span></span></code></pre></div></li><li><p>output_parser/: 输出解析器</p></li><li><p>prompt/: 提示模板</p></li><li><p>strategy/: 智能体策略</p></li></ul><hr><h4 id="📱-应用模块-app-功能-应用配置和运行管理" tabindex="-1">📱 <strong>应用模块</strong> (<code>app/</code>) 功能: 应用配置和运行管理 <a class="header-anchor" href="#📱-应用模块-app-功能-应用配置和运行管理" aria-label="Permalink to &quot;📱 **应用模块** (`app/`)  功能: 应用配置和运行管理&quot;">​</a></h4><ul><li><p>​<code>app_config/</code> - 应用配置管理</p><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">entities.py:配置模块初始化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">base_app_config_manager.py: 基础应用配置管理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">entities.py: 配置实体定义</span></span></code></pre></div></li><li><p>common/ - 通用配置</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • parameters_mapping</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: 参数映射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • sensitive_word_avoidance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: 敏感词规避</span></span></code></pre></div></li><li><p>easy_ui_based_app/ - 简易UI应用配置（12个文件）</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">agent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dataset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model_config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prompt_template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">variables</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span></code></pre></div></li><li><p>workflow_ui_based_app/ - 工作流UI应用配置（3个文件）</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">variables</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  manager.py</span></span></code></pre></div></li><li><p>features/ - 功能配置（15个文件，内部都是manager.py)</p></li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">file_upload</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">more_like_this</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">opening_statement</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retrieval_resource</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">speech_to_text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">suggested_questions_after_answer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text_to_speech</span></span></code></pre></div></li><li><p>​<code>apps/</code> - 应用类型实现</p><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py: 应用模块初始化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • base_app_runner.py: 基础应用运行器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • base_app_generator.py: 基础应用生成器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • base_app_queue_manager.py: 基础应用队列管理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • message_based_app_generator.py: 基于消息的应用生成器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • message_based_app_queue_manager.py: 基于消息的应用队列管理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workflow_app_runner.py: 工作流应用运行器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • exc.py: 应用异常定义</span></span></code></pre></div></li><li><p>advanced_chat/: 高级聊天应用（6个文件）</p></li><li><p>agent_chat/: 智能体聊天应用（5个文件）</p></li><li><p>chat/: 聊天应用（5个文件）</p></li><li><p>completion/: 补全应用（5个文件）</p></li><li><p>workflow/: 工作流应用（7个文件）</p></li><li><p>common/: 通用应用组件（2个文件）</p></li></ul></li><li><p><strong>entities/</strong> - 应用实体</p><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py: 实体模块初始化</span></span></code></pre></div></li><li><p>app_invoke_entities.py: 应用调用实体</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • InvokeFrom: 调用来源枚举（</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SERVICE_API</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WEB_APP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">EXPLORE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEBUGGER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • AppGenerateEntity: 应用生成实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • EasyUIBasedAppGenerateEntity: 简易UI应用生成实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ModelConfigWithCredentialsEntity: 带凭证的模型配置实体</span></span></code></pre></div></li><li><p>queue_entities.py: 队列实体</p></li><li><p>task_entities.py: 任务实体</p></li></ul></li><li><p><strong>features/</strong> - 应用功能</p><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py: 功能模块初始化</span></span></code></pre></div></li><li><p>annotation_reply/: 标注回复功能（2个文件）</p></li><li><p>hosting_moderation/: 托管内容审核功能（2个文件）</p></li><li><p>rate_limiting/: 速率限制功能（2个文件）</p></li></ul></li><li><p><strong>task_pipeline/</strong> - 任务管道</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py: 任务管道初始化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • based_generate_task_pipeline.py: 基于生成的任务管道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • easy_ui_based_generate_task_pipeline.py: 简易UI生成任务管道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • exc.py: 任务管道异常</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • message_cycle_manager.py: 消息循环管理器</span></span></code></pre></div></li></ul><hr><h4 id="base-基础模块" tabindex="-1"><strong>base/</strong> - 基础模块 <a class="header-anchor" href="#base-基础模块" aria-label="Permalink to &quot;**base/**  - 基础模块&quot;">​</a></h4><ul><li><strong>init</strong>.py: 基础模块初始化</li><li>tts/: 文本转语音（2个文件）</li></ul><hr><h4 id="callback-handler-回调处理器" tabindex="-1"><strong>callback_handler/</strong> - 回调处理器 <a class="header-anchor" href="#callback-handler-回调处理器" aria-label="Permalink to &quot;**callback_handler/**  - 回调处理器&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py: 回调处理器初始化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • agent_tool_callback_handler.py: 智能体工具回调处理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • index_tool_callback_handler.py: 索引工具回调处理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workflow_tool_callback_handler.py: 工作流工具回调处理器</span></span></code></pre></div><hr><h4 id="entities-核心实体" tabindex="-1"><strong>entities/</strong> - 核心实体 <a class="header-anchor" href="#entities-核心实体" aria-label="Permalink to &quot;**entities/**  - 核心实体&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py: 实体模块初始化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • agent_entities.py: 智能体实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • embedding_type.py: 嵌入类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • knowledge_entities.py: 知识实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • model_entities.py: 模型实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • parameter_entities.py: 参数实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • provider_configuration.py: 提供商配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • provider_entities.py: 提供商实体</span></span></code></pre></div><hr><h4 id="errors-错误定义" tabindex="-1"><strong>errors/</strong> - 错误定义 <a class="header-anchor" href="#errors-错误定义" aria-label="Permalink to &quot;**errors/**  - 错误定义&quot;">​</a></h4><p>• <strong>init</strong>.py: 错误模块初始化 • error.py: 基础错误类 • provider_error.py: 提供商错误</p><hr><h4 id="extension-扩展模块" tabindex="-1"><strong>extension/</strong> - 扩展模块 <a class="header-anchor" href="#extension-扩展模块" aria-label="Permalink to &quot;**extension/**  - 扩展模块&quot;">​</a></h4><p>• <strong>init</strong>.py: 扩展模块初始化 • extension_base.py: 扩展基类 • extension_manager.py: 扩展管理器 • extension_runner.py: 扩展运行器</p><hr><h4 id="external-data-tool-外部数据工具" tabindex="-1"><strong>external_data_tool/</strong> - 外部数据工具 <a class="header-anchor" href="#external-data-tool-外部数据工具" aria-label="Permalink to &quot;**external_data_tool/**  - 外部数据工具&quot;">​</a></h4><p>• <strong>init</strong>.py: 外部数据工具初始化 • external_data_fetch.py: 外部数据获取 • external_data_tool.py: 外部数据工具 • external_data_tool_factory.py: 外部数据工具工厂 • external_data_tool_manager.py: 外部数据工具管理器 • external_data_tool_runner.py: 外部数据工具运行器 • external_data_tool_runner_factory.py: 外部数据工具运行器工厂</p><hr><h4 id="file-文件处理模块" tabindex="-1"><strong>file/</strong> - 文件处理模块 <a class="header-anchor" href="#file-文件处理模块" aria-label="Permalink to &quot;**file/**  - 文件处理模块&quot;">​</a></h4><p>• <strong>init</strong>.py: 文件模块初始化 • file.py: 文件模型 • file_factory.py: 文件工厂 • file_manager.py: 文件管理器 • file_processor.py: 文件处理器 • file_upload_config.py: 文件上传配置 • helpers.py: 文件辅助函数</p><hr><h4 id="llm-generator-llm生成器-功能-提供基于llm的各种内容生成功能" tabindex="-1"><strong>llm_generator</strong> (LLM生成器) 功能: 提供基于LLM的各种内容生成功能 <a class="header-anchor" href="#llm-generator-llm生成器-功能-提供基于llm的各种内容生成功能" aria-label="Permalink to &quot;**llm_generator** (LLM生成器)  功能: 提供基于LLM的各种内容生成功能&quot;">​</a></h4><ul><li><p>llm_generator.py: 核心生成器类，包含： • generate_conversation_name(): 生成对话标题 • generate_suggested_questions_after_answer(): 生成建议问题 • generate_rule_config(): 生成规则配置 • generate_code(): 生成代码（Python/JavaScript） • generate_qa_document(): 生成问答文档 • generate_structured_output(): 生成结构化输出 • instruction_modify_*(): 指令修改功能</p></li><li><p>prompts.py: 包含各种提示模板</p></li><li><p>output_parser/: 输出解析器</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  rule_config_generator.py: 规则配置生成解析器</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  structured_output.py: 结构化输出解析器</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  suggested_questions_after_answer.py: 建议问题解析器</span></span></code></pre></div></li></ul><hr><h4 id="mcp-model-context-protocol-实现mcp协议-用于与外部工具和服务通信" tabindex="-1"><strong>mcp</strong> (Model Context Protocol): 实现MCP协议，用于与外部工具和服务通信 <a class="header-anchor" href="#mcp-model-context-protocol-实现mcp协议-用于与外部工具和服务通信" aria-label="Permalink to &quot;**mcp** (Model Context Protocol): 实现MCP协议，用于与外部工具和服务通信&quot;">​</a></h4><ul><li><p>根路径</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mcp_client.py: MCP客户端核心实现</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entities.py: MCP实体定义</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> types.py: MCP类型定义</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utils.py: 工具函数</span></span></code></pre></div></li><li><p>auth/: 认证相关</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• auth_flow.py: 认证流程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• auth_provider.py: 认证提供者</span></span></code></pre></div></li><li><p>client/: 客户端实现</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• sse_client.py: Server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Sent Events客户端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• streamable_client.py: 可流式传输客户端</span></span></code></pre></div></li><li><p>server/: 服务器端实现</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• streamable_http.py: HTTP流式传输</span></span></code></pre></div></li><li><p>session/: 会话管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• base_session.py: 基础会话</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• client_session.py: 客户端会话</span></span></code></pre></div></li></ul><hr><h4 id="memory-内存管理-管理对话历史记忆" tabindex="-1"><strong>memory</strong> (内存管理): 管理对话历史记忆 <a class="header-anchor" href="#memory-内存管理-管理对话历史记忆" aria-label="Permalink to &quot;**memory** (内存管理): 管理对话历史记忆&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • token_buffer_memory.py: 基于token的缓冲区内存管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 支持文件处理（图片、文档等）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 智能截断超出token限制的历史消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 支持多模态内容（文本</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">图片）</span></span></code></pre></div><hr><h4 id="model-runtime-模型运行时-统一的模型运行时环境-支持多种ai模型提供商" tabindex="-1"><strong>model_runtime</strong> (模型运行时): 统一的模型运行时环境，支持多种AI模型提供商 <a class="header-anchor" href="#model-runtime-模型运行时-统一的模型运行时环境-支持多种ai模型提供商" aria-label="Permalink to &quot;**model_runtime** (模型运行时): 统一的模型运行时环境，支持多种AI模型提供商&quot;">​</a></h4><ul><li>callbacks/: 回调处理</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• base_callback.py: 基础回调</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• logging_callback.py: 日志回调</span></span></code></pre></div><ul><li>entities/: 实体定义</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• llm_entities.py: LLM实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• message_entities.py: 消息实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• model_entities.py: 模型实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• provider_entities.py: 提供商实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• text_embedding_entities.py: 文本嵌入实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• rerank_entities.py: 重排序实体</span></span></code></pre></div><ul><li>errors/: 错误处理</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• invoke.py: 调用错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• validate.py: 验证错误</span></span></code></pre></div><ul><li><p>model_providers/: 模型提供商实现</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• __base</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: 基础提供商类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• model_provider_factory.py: 提供商工厂</span></span></code></pre></div></li><li><p>schema_validators/: 模式验证器</p></li><li><p>utils/: 工具函数</p></li><li><p>docs/: 文档（中英文）</p></li></ul><hr><h4 id="moderation-内容审核-对用户输入和ai输出进行内容审核" tabindex="-1"><strong>moderation</strong> (内容审核): 对用户输入和AI输出进行内容审核 <a class="header-anchor" href="#moderation-内容审核-对用户输入和ai输出进行内容审核" aria-label="Permalink to &quot;**moderation** (内容审核): 对用户输入和AI输出进行内容审核&quot;">​</a></h4><ul><li><p>根路径</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• base.py: 基础审核类定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• factory.py: 审核器工厂</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• input_moderation.py: 输入审核</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• output_moderation.py: 输出审核</span></span></code></pre></div></li><li><p>api/: API审核实现</p></li><li><p>keywords/: 关键词审核</p></li><li><p>openai_moderation/: OpenAI审核服务</p></li></ul><hr><h4 id="ops-运维监控-系统运维和监控-支持多种追踪服务" tabindex="-1"><strong>ops</strong> (运维监控): 系统运维和监控，支持多种追踪服务 <a class="header-anchor" href="#ops-运维监控-系统运维和监控-支持多种追踪服务" aria-label="Permalink to &quot;**ops** (运维监控): 系统运维和监控，支持多种追踪服务&quot;">​</a></h4><ul><li><p>根路径</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• ops_trace_manager.py: 核心追踪管理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持多种追踪提供商：Langfuse、LangSmith、Opik、Weave、Arize、Phoenix、Al</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">iyun</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 加密</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">解密追踪配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 异步任务处理</span></span></code></pre></div></li><li><p>aliyun_trace/: 阿里云追踪</p></li><li><p>arize_phoenix_trace/: Arize Phoenix追踪</p></li><li><p>langfuse_trace/: Langfuse追踪</p></li><li><p>langsmith_trace/: LangSmith追踪</p></li><li><p>opik_trace/: Opik追踪</p></li><li><p>weave_trace/: Weave追踪</p></li><li><p>entities/: 追踪实体定义</p></li><li><p>utils.py: 工具函数</p></li></ul><hr><h4 id="plugin-插件系统-插件管理和执行" tabindex="-1"><strong>plugin</strong> (插件系统): 插件管理和执行 <a class="header-anchor" href="#plugin-插件系统-插件管理和执行" aria-label="Permalink to &quot;**plugin** (插件系统): 插件管理和执行&quot;">​</a></h4><ul><li><p>entities/: 插件实体定义</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• plugin.py: 插件实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• bundle.py: 插件包</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• endpoint.py: 端点定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• marketplace.py: 市场相关</span></span></code></pre></div></li><li><p>impl/: 插件实现</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• plugin.py: 插件实现</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• tool.py: 工具插件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• model.py: 模型插件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• agent.py: 智能体插件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• oauth.py: OAuth认证</span></span></code></pre></div></li><li><p>backwards_invocation/: 向后兼容调用</p></li><li><p>utils/: 工具函数</p></li><li><p>endpoint/:</p></li></ul><hr><h4 id="prompt-提示管理-提示模板和转换管理" tabindex="-1"><strong>prompt</strong> (提示管理): 提示模板和转换管理 <a class="header-anchor" href="#prompt-提示管理-提示模板和转换管理" aria-label="Permalink to &quot;**prompt** (提示管理): 提示模板和转换管理&quot;">​</a></h4><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• prompt_transform.py: 提示转换基础类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• simple_prompt_transform.py: 简单提示转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• advanced_prompt_transform.py: 高级提示转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• agent_history_prompt_transform.py: 智能体历史提示转换</span></span></code></pre></div></li><li><p>entities/: 提示实体定义</p></li><li><p>prompt_templates/: 提示模板</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持多种模型：baichuan、common等</span></span></code></pre></div></li><li><p>utils/: 工具函数</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• prompt_template_parser.py: 模板解析器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• extract_thread_messages.py: 线程消息提取</span></span></code></pre></div></li></ul><hr><h4 id="rag-检索增强生成-实现rag-retrieval-augmented-generation-功能" tabindex="-1"><strong>rag</strong> (检索增强生成): 实现RAG（Retrieval-Augmented Generation）功能 <a class="header-anchor" href="#rag-检索增强生成-实现rag-retrieval-augmented-generation-功能" aria-label="Permalink to &quot;**rag** (检索增强生成): 实现RAG（Retrieval-Augmented Generation）功能&quot;">​</a></h4><ul><li>cleaner/: 内容清理</li><li>data_post_processor/: 数据后处理</li><li>datasource/: 数据源</li><li>keyword/: 关键词检索</li><li>vdb/: 向量数据库（支持多种VDB）</li><li>docstore/: 文档存储</li><li>embedding/: 嵌入处理</li><li>extractor/: 文档提取器</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持多种格式：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、Word、Excel、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CSV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HTML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、Markdown等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持第三方服务：Firecrawl、Watercrawl、Jina Reader、Unstructured</span></span></code></pre></div><ul><li>index_processor/: 索引处理</li><li>models/: 数据模型</li><li>rerank/: 重排序</li><li>retrieval/: 检索</li><li>splitter/: 文档分割</li></ul><hr><h4 id="repositories-数据仓库-数据访问层-提供数据持久化接口" tabindex="-1"><strong>repositories</strong> (数据仓库): 数据访问层，提供数据持久化接口 <a class="header-anchor" href="#repositories-数据仓库-数据访问层-提供数据持久化接口" aria-label="Permalink to &quot;**repositories** (数据仓库): 数据访问层，提供数据持久化接口&quot;">​</a></h4><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• factory.py: 仓库工厂</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• celery_workflow_execution_repository.py: Celery工作流执行仓库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• celery_workflow_node_execution_repository.py: Celery工作流节点执行仓库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• sqlalchemy_workflow_execution_repository.py: SQLAlchemy工作流执行仓库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• sqlalchemy_workflow_node_execution_repository.py:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SQLAlchemy工作流节点执行仓库</span></span></code></pre></div></li></ul><hr><h4 id="tools-工具系统-统一的工具管理和执行系统" tabindex="-1"><strong>tools</strong> (工具系统): 统一的工具管理和执行系统 <a class="header-anchor" href="#tools-工具系统-统一的工具管理和执行系统" aria-label="Permalink to &quot;**tools** (工具系统): 统一的工具管理和执行系统&quot;">​</a></h4><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• tool_manager.py: 核心工具管理器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持多种工具类型：内置、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、工作流、插件、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MCP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 工具运行时管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 凭据管理和加密</span></span></code></pre></div></li><li><p>builtin_tool/: 内置工具</p><ul><li><p>providers/: 工具提供商</p><ul><li>audio/: 音频工具</li><li>code/: 代码工具</li><li>time/: 时间工具</li><li>webscraper/: 网页抓取工具</li></ul></li></ul></li><li><p>custom_tool/: 自定义工具</p></li><li><p>mcp_tool/: MCP工具</p></li><li><p>plugin_tool/: 插件工具</p></li><li><p>workflow_as_tool/: 工作流作为工具</p></li><li><p>entities/: 工具实体定义</p></li><li><p>utils/: 工具函数</p><ul><li>dataset_retriever/: 数据集检索器</li><li>encryption.py: 加密工具</li><li>web_reader_tool.py: 网页阅读工具</li></ul></li><li><p>workflow_as_tool</p></li></ul><hr><h4 id="variables-变量系统-工作流变量管理和类型系统" tabindex="-1"><strong>variables</strong> (变量系统): 工作流变量管理和类型系统 <a class="header-anchor" href="#variables-变量系统-工作流变量管理和类型系统" aria-label="Permalink to &quot;**variables** (变量系统): 工作流变量管理和类型系统&quot;">​</a></h4><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• variables.py: 变量基类和具体实现</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持多种类型：String、Integer、Float、Object、Array、File、Secret等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• segments.py: 变量段定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• segment_group.py: 变量段组</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• types.py: 变量类型定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• utils.py: 工具函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• consts.py: 常量定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• exc.py: 异常定义</span></span></code></pre></div></li></ul><hr><h4 id="workflow-工作流引擎-核心工作流执行引擎" tabindex="-1"><strong>workflow</strong> (工作流引擎): 核心工作流执行引擎 <a class="header-anchor" href="#workflow-工作流引擎-核心工作流执行引擎" aria-label="Permalink to &quot;**workflow** (工作流引擎): 核心工作流执行引擎&quot;">​</a></h4><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• workflow_entry.py: 工作流入口点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持单步执行和完整工作流执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 变量池管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 回调处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• system_variable.py: 系统变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• variable_loader.py: 变量加载器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• workflow_cycle_manager.py: 工作流循环管理器</span></span></code></pre></div></li><li><p>graph_engine/: 图引擎</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• graph_engine.py: 核心图执行引擎</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• condition_handlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: 条件处理器</span></span></code></pre></div></li><li><p>entities/: 图实体定义</p></li><li><p>nodes/: 工作流节点（104个文件）</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 包含各种类型的节点实现</span></span></code></pre></div></li><li><p>entities/: 工作流实体</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• workflow_execution.py: 工作流执行实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• workflow_node_execution.py: 节点执行实体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• variable_pool.py: 变量池</span></span></code></pre></div></li><li><p>callbacks/: 回调处理</p></li><li><p>repositories/: 工作流数据仓库</p></li><li><p>utils/: 工具函数</p></li></ul><hr></blockquote><h5 id="​controllers-​-​-api控制器层" tabindex="-1"><strong>​<code>controllers/</code>​</strong> ​ <strong>- API控制器层</strong> <a class="header-anchor" href="#​controllers-​-​-api控制器层" aria-label="Permalink to &quot;**​`controllers/`​** ​  **- API控制器层**&quot;">​</a></h5><p>处理HTTP请求的路由和控制器；包含参数验证、权限检查、响应格式化：</p><blockquote><h3 id="controllers-api控制器层" tabindex="-1"><strong>controllers/</strong> <strong>- API控制器层</strong> <a class="header-anchor" href="#controllers-api控制器层" aria-label="Permalink to &quot;**controllers/**   **- API控制器层**&quot;">​</a></h3><h4 id="common-公共组件模块和工具函数" tabindex="-1"><strong>common/</strong> - 公共组件模块和工具函数 <a class="header-anchor" href="#common-公共组件模块和工具函数" aria-label="Permalink to &quot;**common/**  - 公共组件模块和工具函数&quot;">​</a></h4><ul><li><p>errors.py: 定义文件操作相关的异常类</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FilenameNotExistsError: 文件名不存在错误</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RemoteFileUploadError: 远程文件上传错误</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FileTooLargeError: 文件过大错误</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UnsupportedFileTypeError: 不支持的文件类型错误</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TooManyFilesError: 文件数量超限错误</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoFileUploadedError: 未上传文件错误</span></span></code></pre></div></li><li><p>fields.py: API字段模型定义</p></li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• build_system_parameters_model(): 构建系统参数模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• build_parameters_model(): 构建应用参数模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• build_site_model(): 构建站点配置模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 定义各种字段类型：系统参数、应用参数、站点配置等</span></span></code></pre></div><ul><li><p>helpers.py: 文件处理辅助函数</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• FileInfo: 文件信息数据模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• guess_file_info_from_response(): 从HTTP响应中提取文件信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持文件名、MIME类型、扩展名、文件大小的智能识别</span></span></code></pre></div></li></ul><h4 id="console-控制台管理api-包含所有管理功能" tabindex="-1"><strong>console/</strong> - 控制台管理API,包含所有管理功能 <a class="header-anchor" href="#console-控制台管理api-包含所有管理功能" aria-label="Permalink to &quot;**console/**  - 控制台管理API,包含所有管理功能&quot;">​</a></h4><p><strong>init</strong>.py: 控制台API路由注册，包含所有子模块的路由配置</p><ul><li>admin.py: 管理员功能</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• InsertExploreAppListApi: 插入探索应用列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• InsertExploreAppApi: 插入</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">删除探索应用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持应用推荐、分类管理、位置排序</span></span></code></pre></div><ul><li><p>apikey.py: API密钥管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• BaseApiKeyListResource: API密钥列表基类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• BaseApiKeyResource: API密钥操作基类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• AppApiKeyListResource: 应用API密钥管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• DatasetApiKeyListResource: 数据集API密钥管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持创建、删除、查看API密钥，限制每个资源最多10个密钥</span></span></code></pre></div></li><li><p>extension.py: 扩展功能管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• CodeBasedExtensionAPI: 基于代码的扩展</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• APIBasedExtensionAPI: 基于API的扩展管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• APIBasedExtensionDetailAPI: 扩展详情管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持扩展的创建、更新、删除、查询</span></span></code></pre></div></li><li><p>feature.py: 功能特性管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• FeatureApi: 获取租户功能特性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• SystemFeatureApi: 获取系统功能特性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持功能开关、限制检查</span></span></code></pre></div></li><li><p>files.py: 文件管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• FileApi: 文件上传和配置获取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• FilePreviewApi: 文件预览</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• FileSupportTypeApi: 支持的文件类型查询</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持文件上传、预览、类型检查</span></span></code></pre></div></li><li><p>remote_files.py: 远程文件处理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• RemoteFileInfoApi: 获取远程文件信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• RemoteFileUploadApi: 上传远程文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持从URL下载并上传文件</span></span></code></pre></div></li><li><p>init_validate.py: 初始化验证 • InitValidateAPI: 初始化验证接口 • get_init_validate_status(): 获取初始化状态 • 仅自托管版本使用</p></li><li><p>ping.py: 健康检查</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• PingApi: 简单的ping</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pong健康检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• setup.py: 系统设置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• SetupApi: 系统初始化设置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• get_setup_status(): 获取设置状态</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 仅自托管版本使用</span></span></code></pre></div></li><li><p>version.py: 版本管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• VersionApi: 版本检查和更新</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• _has_new_version(): 版本比较逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持自动更新检查</span></span></code></pre></div></li><li><p>error.py: 控制台错误定义</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 定义各种控制台相关的异常类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 包括设置、账户、工作空间、计费等相关错误</span></span></code></pre></div></li><li><p>wraps.py: 装饰器和中间件</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 各种权限验证装饰器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 计费限制检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 版本限制检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 功能开关检查</span></span></code></pre></div></li><li><p><strong>app/</strong> (24个文件) - 应用管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • app.py: 应用CRUD操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workflow.py: 工作流管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • conversation.py: 对话管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • message.py: 消息管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • audio.py: 音频处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • completion.py: 文本补全</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • generator.py: 生成器管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • annotation.py: 标注管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • statistic.py: 统计信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • site.py: 站点配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • model_config.py: 模型配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • mcp_server.py: MCP服务器管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • ops_trace.py: 操作追踪</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workflow_run.py: 工作流运行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workflow_app_log.py: 工作流应用日志</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workflow_statistic.py: 工作流统计</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workflow_draft_variable.py: 工作流草稿变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • conversation_variables.py: 对话变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • advanced_prompt_template.py: 高级提示模板</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • agent.py: 智能体管理</span></span></code></pre></div></li><li><p><strong>auth/</strong> (8个文件) - 认证授权</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • login.py: 用户登录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • oauth.py: OAuth认证（GitHub、Google）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • forgot_password.py: 密码重置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • activate.py: 账户激活</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • data_source_bearer_auth.py: 数据源Bearer认证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • data_source_oauth.py: 数据源OAuth认证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • oauth_server.py: OAuth服务器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • error.py: 认证相关错误</span></span></code></pre></div></li><li><p><strong>billing/</strong> (3个文件) - 计费管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • billing.py: 计费相关功能</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • compliance.py: 合规性检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • error.py: 计费相关错误</span></span></code></pre></div></li><li><p><strong>datasets/</strong> (10个文件) - 数据集管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • datasets.py: 数据集CRUD操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • datasets_document.py: 数据集文档管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • datasets_segments.py: 数据集分段管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • data_source.py: 数据源管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • external.py: 外部数据源</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • website.py: 网站爬取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • hit_testing.py: 命中测试</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • hit_testing_base.py: 命中测试基类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • metadata.py: 元数据管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • error.py: 数据集相关错误</span></span></code></pre></div></li><li><p><strong>explore/</strong> (11个文件) - 应用探索</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • installed_app.py: 已安装应用管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • parameter.py: 参数配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • recommended_app.py: 推荐应用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • saved_message.py: 保存的消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • audio.py: 音频处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • completion.py: 文本补全</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • conversation.py: 对话管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • message.py: 消息管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workflow.py: 工作流</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • app_import.py: 应用导入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • app_import_check_dependencies.py: 导入依赖检查</span></span></code></pre></div></li><li><p><strong>workspace/</strong> (12个文件) - 工作空间管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • workspace.py: 工作空间CRUD操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • account.py: 账户管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • members.py: 成员管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • model_providers.py: 模型提供商管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • models.py: 模型管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • agent_providers.py: 智能体提供商管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • tool_providers.py: 工具提供商管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • plugin.py: 插件管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • endpoint.py: 端点管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • load_balancing_config.py: 负载均衡配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • error.py: 工作空间相关错误</span></span></code></pre></div></li><li><p><strong>tag/</strong> (1个文件) - 标签管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • tags.py: 标签CRUD操作</span></span></code></pre></div></li></ul><h4 id="files-文件服务api" tabindex="-1"><strong>files/</strong> - 文件服务API <a class="header-anchor" href="#files-文件服务api" aria-label="Permalink to &quot;**files/**  - 文件服务API&quot;">​</a></h4><ul><li><p><strong>init</strong>.py: 文件API路由注册</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • upload.py: 文件上传（支持插件文件上传）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • PluginUploadFileApi: 插件文件上传接口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 支持签名验证、文件类型检查、大小限制</span></span></code></pre></div></li><li><p>image_preview.py: 图片预览</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ImagePreviewApi: 图片预览接口（已废弃）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • FilePreviewApi: 文件预览接口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • WorkspaceWebappLogoApi: 工作空间Web应用Logo</span></span></code></pre></div></li><li><p>tool_files.py: 工具文件处理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ToolFileApi: 工具文件访问接口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 支持签名验证、文件下载</span></span></code></pre></div></li></ul><h4 id="inner-api-内部系统通信api" tabindex="-1"><strong>inner_api/</strong> - 内部系统通信API <a class="header-anchor" href="#inner-api-内部系统通信api" aria-label="Permalink to &quot;**inner_api/**  - 内部系统通信API&quot;">​</a></h4><ul><li><p><strong>init</strong>.py: 内部API路由注册</p></li><li><p>mail.py: 邮件服务</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• EnterpriseMail: 企业邮件发送</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• BillingMail: 计费邮件发送</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持异步邮件发送</span></span></code></pre></div></li><li><p>wraps.py: 内部API装饰器</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• billing_inner_api_only: 计费内部API验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• enterprise_inner_api_only: 企业内部API验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• enterprise_inner_api_user_auth: 企业用户认证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• plugin_inner_api_only: 插件内部API验证</span></span></code></pre></div></li><li><p>plugin/ (3个文件) - 插件通信</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• plugin.py: 插件相关API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• wraps.py: 插件装饰器</span></span></code></pre></div></li><li><p>workspace/ (2个文件) - 工作空间内部API</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 工作空间相关的内部接口</span></span></code></pre></div></li></ul><h4 id="mcp-mcp模型上下文协议api" tabindex="-1"><strong>mcp/</strong> - MCP模型上下文协议API <a class="header-anchor" href="#mcp-mcp模型上下文协议api" aria-label="Permalink to &quot;**mcp/**  - MCP模型上下文协议API&quot;">​</a></h4><ul><li><p><strong>init</strong>.py: MCP API路由注册</p></li><li><p>mcp.py: Model Context Protocol处理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• MCPAppApi: MCP应用接口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• MCPRequestError: MCP请求错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持JSON</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RPC格式的MCP请求处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 处理MCP服务器状态验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持用户输入表单处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 支持通知和请求两种消息类型</span></span></code></pre></div></li></ul><h4 id="service-api-核心服务api-提供应用和数据集的核心功能" tabindex="-1"><strong>service_api/</strong> - 核心服务API，提供应用和数据集的核心功能 <a class="header-anchor" href="#service-api-核心服务api-提供应用和数据集的核心功能" aria-label="Permalink to &quot;**service_api/**  - 核心服务API，提供应用和数据集的核心功能&quot;">​</a></h4><ul><li><p><strong>init</strong>.py: 服务API路由注册</p></li><li><p>index.py: 服务入口</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• IndexApi: API欢迎页面</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 返回API版本和服务器版本信息</span></span></code></pre></div></li><li><p>wraps.py: 服务API装饰器</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • validate_app_token: 应用令牌验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • validate_dataset_token: 数据集令牌验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • cloud_edition_billing_resource_check: 云版本计费资源检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • cloud_edition_billing_knowledge_limit_check: 知识库限制检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • cloud_edition_billing_rate_limit_check: 速率限制检查</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • create_or_update_end_user_for_user_id: 创建或更新终端用户</span></span></code></pre></div></li><li><p>app/ (12个文件) - 应用服务</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • app.py: 应用信息获取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • completion.py: 文本补全服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • conversation.py: 对话服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • message.py: 消息服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • workflow.py: 工作流服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • audio.py: 音频服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • annotation.py: 标注服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py: 文件服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • file_preview.py: 文件预览服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • site.py: 站点服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • error.py: 服务相关错误</span></span></code></pre></div></li><li><p>dataset/ (8个文件) - 数据集服务</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • dataset.py: 数据集服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • document.py: 文档服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • segment.py: 分段服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • upload_file.py: 文件上传服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • hit_testing.py: 命中测试服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • metadata.py: 元数据服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • error.py: 数据集服务错误</span></span></code></pre></div></li><li><p>workspace/ (1个文件) - 工作空间服务</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • models.py: 模型服务</span></span></code></pre></div></li></ul><h4 id="web-web应用api" tabindex="-1"><strong>web/</strong> - Web应用API <a class="header-anchor" href="#web-web应用api" aria-label="Permalink to &quot;**web/**  - Web应用API&quot;">​</a></h4><ul><li><p><strong>init</strong>.py: Web API路由注册</p></li><li><p>wraps.py: Web API装饰器</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • validate_jwt_token: JWT令牌验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • decode_jwt_token: JWT令牌解码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • WebApiResource: Web API资源基类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 支持企业级Web应用认证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 支持SSO认证验证</span></span></code></pre></div></li><li><p>app.py: Web应用管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • AppParameterApi: 应用参数获取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • AppSiteApi: 应用站点信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • AppMetaApi: 应用元数据</span></span></code></pre></div></li><li><p>completion.py: Web文本补全</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • CompletionApi: 文本补全接口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 支持阻塞和流式响应模式</span></span></code></pre></div></li><li><p>conversation.py: Web对话管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ConversationApi: 对话接口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ConversationListApi: 对话列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ConversationRenameApi: 对话重命名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ConversationPinApi: 对话置顶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ConversationUnPinApi: 取消置顶</span></span></code></pre></div></li><li><p>message.py: Web消息管理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • MessageListApi: 消息列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • MessageFeedbackApi: 消息反馈</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • MessageMoreLikeThisApi: 相似消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • MessageSuggestedQuestionApi: 建议问题</span></span></code></pre></div></li><li><p>workflow.py: Web工作流</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • WorkflowRunApi: 工作流运行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • WorkflowTaskStopApi: 工作流任务停止</span></span></code></pre></div></li><li><p>audio.py: Web音频处理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ChatAudioApi: 聊天音频</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ChatTextApi: 聊天文本</span></span></code></pre></div></li><li><p>files.py: Web文件处理</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • FileUploadApi: 文件上传</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • FilePreviewApi: 文件预览</span></span></code></pre></div></li><li><p>remote_files.py: Web远程文件</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • RemoteFileInfoApi: 远程文件信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • RemoteFileUploadApi: 远程文件上传</span></span></code></pre></div></li><li><p>login.py: Web登录</p></li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • LoginApi: 登录接口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • LogoutApi: 登出接口</span></span></code></pre></div><ul><li><p>passport.py: Web通行证</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • PassportApi: 通行证接口</span></span></code></pre></div></li><li><p>forgot_password.py: Web密码重置</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ForgotPasswordSendEmailApi: 发送重置邮件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • ResetPasswordApi: 重置密码</span></span></code></pre></div></li><li><p>saved_message.py: Web保存消息</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • SavedMessageListApi: 保存消息列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • SavedMessageCreateApi: 创建保存消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • SavedMessageUpdateApi: 更新保存消息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • SavedMessageDeleteApi: 删除保存消息</span></span></code></pre></div></li><li><p>site.py: Web站点</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • SiteApi: 站点信息</span></span></code></pre></div></li><li><p>feature.py: Web功能特性</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • FeatureApi: 功能特性获取</span></span></code></pre></div></li><li><p>error.py: Web错误定义</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • 定义Web应用相关的异常类</span></span></code></pre></div></li></ul></blockquote><p>‍</p><h5 id="​​services-​-​-业务服务层-106个文件" tabindex="-1">​<strong>​<code>services/</code>​</strong> ​ <strong>- 业务服务层</strong> (106个文件) <a class="header-anchor" href="#​​services-​-​-业务服务层-106个文件" aria-label="Permalink to &quot;​**​`services/`​** ​  **- 业务服务层** (106个文件)&quot;">​</a></h5><blockquote><h4 id="根目录-2" tabindex="-1">根目录 <a class="header-anchor" href="#根目录-2" aria-label="Permalink to &quot;根目录&quot;">​</a></h4><h5 id="核心应用服务" tabindex="-1">核心应用服务 <a class="header-anchor" href="#核心应用服务" aria-label="Permalink to &quot;核心应用服务&quot;">​</a></h5><p>• <code>app_service.py</code> - 应用管理服务，处理应用的创建、更新、删除、分页查询等核心功能 • <code>conversation_service.py</code> - 对话管理服务，处理对话的创建、查询、分页、变量管理等 • <code>message_service.py</code> - 消息管理服务，处理消息的创建、查询、分页、反馈等功能 • <code>workflow_service.py</code> - 工作流服务，处理工作流的创建、执行、节点管理等 • <code>agent_service.py</code> - 智能代理服务，处理代理日志、工具调用等</p><h5 id="数据和知识管理" tabindex="-1">数据和知识管理 <a class="header-anchor" href="#数据和知识管理" aria-label="Permalink to &quot;数据和知识管理&quot;">​</a></h5><p>• <code>dataset_service.py</code> - 数据集管理服务，处理数据集的创建、文档上传、分段、索引等 • <code>vector_service.py</code> - 向量服务，处理文档分段的向量化、索引创建等 • <code>knowledge_service.py</code> - 知识库服务，处理知识库的创建和管理 • <code>external_knowledge_service.py</code> - 外部知识服务，处理外部知识源的集成</p><h5 id="模型和工具管理" tabindex="-1">模型和工具管理 <a class="header-anchor" href="#模型和工具管理" aria-label="Permalink to &quot;模型和工具管理&quot;">​</a></h5><p>• <code>model_provider_service.py</code> - 模型提供商服务，管理各种AI模型的配置和状态 • <code>model_load_balancing_service.py</code> - 模型负载均衡服务 • <code>file_service.py</code> - 文件管理服务，处理文件上传、预览、存储等</p><h5 id="用户和权限管理" tabindex="-1">用户和权限管理 <a class="header-anchor" href="#用户和权限管理" aria-label="Permalink to &quot;用户和权限管理&quot;">​</a></h5><p>• <code>account_service.py</code> - 账户管理服务 • <code>workspace_service.py</code> - 工作空间管理服务 • <code>webapp_auth_service.py</code> - Web应用认证服务 • <code>web_conversation_service.py</code> - Web对话服务</p><h5 id="其他功能服务" tabindex="-1">其他功能服务 <a class="header-anchor" href="#其他功能服务" aria-label="Permalink to &quot;其他功能服务&quot;">​</a></h5><p>• <code>audio_service.py</code> - 音频处理服务 • <code>billing_service.py</code> - 计费服务 • <code>feature_service.py</code> - 功能特性服务 • <code>tag_service.py</code> - 标签管理服务 • <code>website_service.py</code> - 网站服务 • <code>operation_service.py</code> - 操作服务 • <code>ops_service.py</code> - 运维服务</p><hr><h4 id="🔐-auth-认证服务目录" tabindex="-1">🔐 <code>auth/</code> - 认证服务目录 <a class="header-anchor" href="#🔐-auth-认证服务目录" aria-label="Permalink to &quot;🔐 `auth/` - 认证服务目录&quot;">​</a></h4><ul><li><h5 id="根目录-3" tabindex="-1">根目录 <a class="header-anchor" href="#根目录-3" aria-label="Permalink to &quot;根目录&quot;">​</a></h5><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`api_key_auth_base.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> API密钥认证基类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`api_key_auth_factory.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> API密钥认证工厂</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`api_key_auth_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> API密钥认证服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`auth_type.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 认证类型定义</span></span></code></pre></div></li><li><p>​<code>firecrawl/</code> - Firecrawl爬虫认证</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• firecrawl.py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Firecrawl API认证实现</span></span></code></pre></div></li><li><p><code>jina/</code> - Jina Reader认证</p></li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• jina.py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jina Reader API认证实现</span></span></code></pre></div><ul><li><code>watercrawl/</code> - Watercrawl爬虫认证</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• watercrawl.py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Watercrawl API认证实现</span></span></code></pre></div><hr><h4 id="🏢-enterprise-企业级功能目录" tabindex="-1">🏢 <code>enterprise/</code> - 企业级功能目录 <a class="header-anchor" href="#🏢-enterprise-企业级功能目录" aria-label="Permalink to &quot;🏢 `enterprise/` - 企业级功能目录&quot;">​</a></h4><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`base.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 企业服务基类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`enterprise_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 企业服务，处理企业级功能如SSO、工作空间管理等</span></span></code></pre></div></li></ul><hr><h4 id="🏗️-entities-实体定义目录" tabindex="-1">🏗️ <code>entities/</code> - 实体定义目录 <a class="header-anchor" href="#🏗️-entities-实体定义目录" aria-label="Permalink to &quot;🏗️ `entities/` - 实体定义目录&quot;">​</a></h4><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`model_provider_entities.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 模型提供商实体定义</span></span></code></pre></div></li><li><p><code>external_knowledge_entities/</code> - 外部知识实体</p></li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • external_knowledge_entities.py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 外部知识相关实体定义</span></span></code></pre></div><ul><li><code>knowledge_entities/</code> - 知识实体</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    • knowledge_entities.py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 知识库相关实体定义</span></span></code></pre></div><hr><h4 id="❌-errors-错误处理目录-包含各种业务模块的专用错误类" tabindex="-1">❌ <code>errors/</code> - 错误处理目录: 包含各种业务模块的专用错误类： <a class="header-anchor" href="#❌-errors-错误处理目录-包含各种业务模块的专用错误类" aria-label="Permalink to &quot;❌ `errors/` - 错误处理目录:  包含各种业务模块的专用错误类：&quot;">​</a></h4><ul><li><h5 id="根目录-4" tabindex="-1">根目录 <a class="header-anchor" href="#根目录-4" aria-label="Permalink to &quot;根目录&quot;">​</a></h5><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">base.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 基础错误类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">account.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 账户相关错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 应用相关错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 对话相关错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dataset.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 数据集相关错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 文件相关错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">message.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 消息相关错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">plugin.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 插件相关错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;code&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">workflow_service.py</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">span</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 工作流服务错误</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• 等等</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div></li></ul><hr><h4 id="🔌-plugin-插件管理目录" tabindex="-1">🔌 <code>plugin/</code> - 插件管理目录 <a class="header-anchor" href="#🔌-plugin-插件管理目录" aria-label="Permalink to &quot;🔌 `plugin/` - 插件管理目录&quot;">​</a></h4><ul><li><h5 id="根目录-5" tabindex="-1">根目录 <a class="header-anchor" href="#根目录-5" aria-label="Permalink to &quot;根目录&quot;">​</a></h5><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`plugin_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 插件核心服务，处理插件的安装、卸载、管理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`plugin_parameter_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 插件参数服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`plugin_permission_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 插件权限服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`plugin_auto_upgrade_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 插件自动升级服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`plugin_migration.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 插件迁移服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`data_migration.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 数据迁移服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`dependencies_analysis.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 依赖分析服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`endpoint_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 端点服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`oauth_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OAuth服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`github_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GitHub服务</span></span></code></pre></div></li></ul><hr><h4 id="🛠️-tools-工具管理目录" tabindex="-1">🛠️ <code>tools/</code> - 工具管理目录 <a class="header-anchor" href="#🛠️-tools-工具管理目录" aria-label="Permalink to &quot;🛠️ `tools/` - 工具管理目录&quot;">​</a></h4><ul><li><p>根目录</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`tools_manage_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 工具管理服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`builtin_tools_manage_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 内置工具管理服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`api_tools_manage_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> API工具管理服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`mcp_tools_manage_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MCP工具管理服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`workflow_tools_manage_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 工作流工具管理服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`tool_labels_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 工具标签服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`tools_transform_service.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 工具转换服务</span></span></code></pre></div></li></ul><hr><h4 id="🔄-workflow-工作流目录" tabindex="-1">🔄 <code>workflow/</code> - 工作流目录 <a class="header-anchor" href="#🔄-workflow-工作流目录" aria-label="Permalink to &quot;🔄 `workflow/` - 工作流目录&quot;">​</a></h4><ul><li><h5 id="根目录-6" tabindex="-1">根目录 <a class="header-anchor" href="#根目录-6" aria-label="Permalink to &quot;根目录&quot;">​</a></h5><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`workflow_converter.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 工作流转换器，处理不同版本工作流之间的转换</span></span></code></pre></div></li></ul><hr><p>📱 <code>recommend_app/</code> - 推荐应用目录</p><ul><li><h5 id="根目录-7" tabindex="-1">根目录 <a class="header-anchor" href="#根目录-7" aria-label="Permalink to &quot;根目录&quot;">​</a></h5><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`recommend_app_base.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 推荐应用基类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`recommend_app_factory.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 推荐应用工厂</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  • </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">`recommend_app_type.py`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 推荐应用类型</span></span></code></pre></div></li><li><p>​<code>buildin/</code> - 内置推荐应用</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• buildin_retrieval.py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 内置检索推荐</span></span></code></pre></div></li><li><p><code>database/</code> - 数据库推荐应用</p></li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• database_retrieval.py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 数据库检索推荐</span></span></code></pre></div><ul><li><code>remote/</code> - 远程推荐应用</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">• remote_retrieval.py </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 远程检索推荐</span></span></code></pre></div></blockquote><h5 id="​models-​-​-数据模型层-16个文件" tabindex="-1"><strong>​<code>models/</code>​</strong> ​ <strong>- 数据模型层</strong> (16个文件) <a class="header-anchor" href="#​models-​-​-数据模型层-16个文件" aria-label="Permalink to &quot;**​`models/`​** ​  **- 数据模型层** (16个文件)&quot;">​</a></h5><p>数据库模型定义：</p><blockquote><h3 id="基础文件" tabindex="-1">基础文件 <a class="header-anchor" href="#基础文件" aria-label="Permalink to &quot;基础文件&quot;">​</a></h3><h5 id="base-py-基础模型类" tabindex="-1"><code>base.py</code> - 基础模型类 <a class="header-anchor" href="#base-py-基础模型类" aria-label="Permalink to &quot;`base.py` - 基础模型类&quot;">​</a></h5><p>• Base类: SQLAlchemy的DeclarativeBase基类，定义了metadata • TypeBase类: 带有类型注解的基类，用于添加类型支持</p><h5 id="enums-py-枚举定义" tabindex="-1"><code>enums.py</code> - 枚举定义 <a class="header-anchor" href="#enums-py-枚举定义" aria-label="Permalink to &quot;`enums.py` - 枚举定义&quot;">​</a></h5><p>• CreatorUserRole: 用户角色枚举（account, end_user） • UserFrom: 用户来源枚举 • WorkflowRunTriggeredFrom: 工作流触发来源枚举 • DraftVariableType: 草稿变量类型枚举 • MessageStatus: 消息状态枚举</p><h5 id="types-py-类型定义" tabindex="-1"><code>types.py</code> - 类型定义 <a class="header-anchor" href="#types-py-类型定义" aria-label="Permalink to &quot;`types.py` - 类型定义&quot;">​</a></h5><p>• StringUUID: 自定义UUID类型装饰器，支持PostgreSQL和MySQL • EnumText: 枚举文本类型装饰器，用于存储枚举值</p><h5 id="engine-py-数据库引擎" tabindex="-1"><code>engine.py</code> - 数据库引擎 <a class="header-anchor" href="#engine-py-数据库引擎" aria-label="Permalink to &quot;`engine.py` - 数据库引擎&quot;">​</a></h5><p>• db: SQLAlchemy实例，配置了PostgreSQL索引命名约定 • metadata: 数据库元数据配置</p><h3 id="用户和账户管理" tabindex="-1">用户和账户管理 <a class="header-anchor" href="#用户和账户管理" aria-label="Permalink to &quot;用户和账户管理&quot;">​</a></h3><h5 id="​account-py-账户相关模型" tabindex="-1">​<code>account.py</code> - 账户相关模型 <a class="header-anchor" href="#​account-py-账户相关模型" aria-label="Permalink to &quot;​`account.py` - 账户相关模型&quot;">​</a></h5><p>主要类： • TenantAccountRole: 租户账户角色枚举（owner, admin, editor, normal,dataset_operator） • AccountStatus: 账户状态枚举 • Account: 用户账户模型 • 包含用户基本信息（姓名、邮箱、密码等） • 支持多租户架构 • 提供角色权限检查方法 • Tenant: 租户模型 • TenantAccountJoin: 租户账户关联表 • AccountIntegrate: 第三方账户集成 • InvitationCode: 邀请码管理 • TenantPluginPermission: 租户插件权限 • TenantPluginAutoUpgradeStrategy: 插件自动升级策略</p><h3 id="应用管理" tabindex="-1">应用管理 <a class="header-anchor" href="#应用管理" aria-label="Permalink to &quot;应用管理&quot;">​</a></h3><p><code>model.py</code> - 应用相关模型</p><p>主要类： • AppMode: 应用模式枚举（completion, workflow, chat, advanced-chat, agent-chat） • App: 应用模型 • 支持多种应用模式 • 包含应用配置、状态管理 • 提供工具删除检测功能 • AppModelConfig: 应用模型配置 • 存储模型参数、提示词配置 • 支持代理模式、文件上传等配置 • Conversation: 对话模型 • 支持文件输入处理 • 提供反馈统计功能 • Message: 消息模型 • 支持文件重新签名 • 提供反馈和注释功能 • MessageFeedback: 消息反馈 • MessageFile: 消息文件 • MessageAnnotation: 消息注释 • EndUser: 终端用户模型 • Site: 网站配置模型 • ApiToken: API令牌模型 • UploadFile: 上传文件模型 • Tag: 标签模型 • TagBinding: 标签绑定模型</p><h3 id="模型提供商管理" tabindex="-1">模型提供商管理 <a class="header-anchor" href="#模型提供商管理" aria-label="Permalink to &quot;模型提供商管理&quot;">​</a></h3><p><code>provider.py</code> - 提供商模型</p><p>主要类： • ProviderType: 提供商类型枚举（custom, system） • ProviderQuotaType: 配额类型枚举（paid, free, trial） • Provider: 提供商模型 • 支持多种提供商类型 • 包含配额管理 • 提供凭证管理 • ProviderModel: 提供商模型配置 • TenantDefaultModel: 租户默认模型 • TenantPreferredModelProvider: 租户首选模型提供商 • ProviderOrder: 提供商订单 • ProviderModelSetting: 提供商模型设置 • LoadBalancingModelConfig: 负载均衡模型配置 • ProviderCredential: 提供商凭证 • ProviderModelCredential: 提供商模型凭证</p><h3 id="数据集管理" tabindex="-1">数据集管理 <a class="header-anchor" href="#数据集管理" aria-label="Permalink to &quot;数据集管理&quot;">​</a></h3><p><code>dataset.py</code> - 数据集模型</p><p>主要类： • DatasetPermissionEnum: 数据集权限枚举 • Dataset: 数据集模型 • 支持多种数据源类型 • 包含索引技术配置 • 提供文档统计功能 • DatasetProcessRule: 数据集处理规则 • Document: 文档模型 • 支持多种数据源（上传文件、Notion导入、网站爬取） • 提供处理状态管理 • 包含元数据支持 • DocumentSegment: 文档片段模型 • ChildChunk: 子块模型 • AppDatasetJoin: 应用数据集关联 • DatasetQuery: 数据集查询 • DatasetKeywordTable: 数据集关键词表 • Embedding: 嵌入向量模型 • DatasetCollectionBinding: 数据集集合绑定 • ExternalKnowledgeApis: 外部知识API • ExternalKnowledgeBindings: 外部知识绑定 • DatasetMetadata: 数据集元数据 • DatasetMetadataBinding: 数据集元数据绑定</p><h3 id="数据源管理" tabindex="-1">数据源管理 <a class="header-anchor" href="#数据源管理" aria-label="Permalink to &quot;数据源管理&quot;">​</a></h3><p><code>source.py</code> - 数据源模型</p><p>主要类： • DataSourceOauthBinding: 数据源OAuth绑定 • DataSourceApiKeyAuthBinding: 数据源API密钥认证绑定</p><h3 id="web相关" tabindex="-1">Web相关 <a class="header-anchor" href="#web相关" aria-label="Permalink to &quot;Web相关&quot;">​</a></h3><p><code>web.py</code> - Web相关模型</p><p>主要类： • SavedMessage: 保存的消息 • PinnedConversation: 置顶对话</p><h3 id="任务管理" tabindex="-1">任务管理 <a class="header-anchor" href="#任务管理" aria-label="Permalink to &quot;任务管理&quot;">​</a></h3><p><code>task.py</code> - 任务模型</p><p>主要类： • CeleryTask: Celery任务元数据 • CeleryTaskSet: Celery任务集元数据</p><h3 id="工作流管理" tabindex="-1">工作流管理 <a class="header-anchor" href="#工作流管理" aria-label="Permalink to &quot;工作流管理&quot;">​</a></h3><p><code>workflow.py</code> - 工作流模型</p><p>主要类： • WorkflowType: 工作流类型枚举 • Workflow: 工作流模型 • 支持工作流和聊天两种类型 • 包含图形配置、环境变量、对话变量 • 提供节点配置获取功能 • WorkflowRun: 工作流运行模型 • 记录工作流执行状态 • 包含输入输出、错误信息、执行时间等 • WorkflowNodeExecutionModel: 工作流节点执行模型 • 记录单个节点的执行详情 • 包含输入输出、处理数据、执行元数据 • WorkflowAppLog: 工作流应用日志 • ConversationVariable: 对话变量 • WorkflowDraftVariable: 工作流草稿变量 • 支持对话变量、系统变量、节点变量 • 提供变量类型和值管理</p><p><code>_workflow_exc.py</code> - 工作流异常</p><p>主要类： • WorkflowDataError: 工作流数据错误基类 • NodeNotFoundError: 节点未找到异常</p><h3 id="工具管理" tabindex="-1">工具管理 <a class="header-anchor" href="#工具管理" aria-label="Permalink to &quot;工具管理&quot;">​</a></h3><p><code>tools.py</code> - 工具模型</p><p>主要类： • ToolOAuthSystemClient: 系统级工具OAuth客户端 • ToolOAuthTenantClient: 租户级工具OAuth客户端 • BuiltinToolProvider: 内置工具提供商 • ApiToolProvider: API工具提供商 • ToolLabelBinding: 工具标签绑定 • WorkflowToolProvider: 工作流工具提供商 • MCPToolProvider: MCP工具提供商 • ToolModelInvoke: 工具模型调用日志 • ToolFile: 工具文件 • DeprecatedPublishedAppTool: 已弃用的发布应用工具</p><h3 id="api扩展" tabindex="-1">API扩展 <a class="header-anchor" href="#api扩展" aria-label="Permalink to &quot;API扩展&quot;">​</a></h3><p><code>api_based_extension.py</code> - API扩展模型</p><p>主要类： • APIBasedExtensionPoint: API扩展点枚举 • APIBasedExtension: API扩展模型</p></blockquote><h5 id="​tasks-​-​-异步任务-42个文件" tabindex="-1"><strong>​<code>tasks/</code>​</strong> ​ <strong>- 异步任务</strong> (42个文件) <a class="header-anchor" href="#​tasks-​-​-异步任务-42个文件" aria-label="Permalink to &quot;**​`tasks/`​** ​  **- 异步任务** (42个文件)&quot;">​</a></h5><p>‍</p><p>Celery异步任务：<br> • 文档索引任务 - document_indexing_task.py<br> • 数据集清理任务 - clean_dataset_task.py<br> • 邮件发送任务 - mail_*_task.py<br> • 工作流执行任务 - workflow_execution_tasks.py</p><h5 id="​configs-​-​-配置管理" tabindex="-1"><strong>​<code>configs/</code>​</strong> ​ <strong>- 配置管理</strong> <a class="header-anchor" href="#​configs-​-​-配置管理" aria-label="Permalink to &quot;**​`configs/`​** ​  **- 配置管理**&quot;">​</a></h5><p>• <code>app_config.py</code>​ - 应用配置<br> • <code>middleware/</code>​ - 中间件配置<br> • <code>storage/</code>​ - 存储配置(支持多种云存储)<br> • <code>vdb/</code>​ - 向量数据库配置<br> • <code>cache/</code>​ - 缓存配置<br> • <code>feature/</code>​ - 功能特性配置<br> • <code>enterprise/</code> - 企业版配置</p><h5 id="​extensions-​-​-flask扩展-41个文件" tabindex="-1"><strong>​<code>extensions/</code>​</strong> ​ <strong>- Flask扩展</strong> (41个文件) <a class="header-anchor" href="#​extensions-​-​-flask扩展-41个文件" aria-label="Permalink to &quot;**​`extensions/`​** ​  **- Flask扩展** (41个文件)&quot;">​</a></h5><p>Flask应用扩展：<br> • <code>ext_database.py</code>​ - 数据库扩展<br> • <code>ext_celery.py</code>​ - Celery扩展<br> • <code>ext_redis.py</code>​ - Redis扩展<br> • <code>ext_storage.py</code>​ - 存储扩展<br> • <code>storage/</code> - 存储实现</p><h5 id="​events-​-​-事件系统-17个文件" tabindex="-1"><strong>​<code>events/</code>​</strong> ​ <strong>- 事件系统</strong> (17个文件) <a class="header-anchor" href="#​events-​-​-事件系统-17个文件" aria-label="Permalink to &quot;**​`events/`​** ​  **- 事件系统** (17个文件)&quot;">​</a></h5><p>事件驱动架构：<br> • <code>app_event.py</code>​ - 应用事件<br> • <code>dataset_event.py</code>​ - 数据集事件<br> • <code>event_handlers/</code> - 事件处理器</p><h5 id="​migrations-​-​-数据库迁移-146个文件" tabindex="-1"><strong>​<code>migrations/</code>​</strong> ​ <strong>- 数据库迁移</strong> (146个文件) <a class="header-anchor" href="#​migrations-​-​-数据库迁移-146个文件" aria-label="Permalink to &quot;**​`migrations/`​** ​  **- 数据库迁移** (146个文件)&quot;">​</a></h5><p>• <code>versions/</code>​ - Alembic迁移版本文件<br> • <code>env.py</code> - 迁移环境配置</p><h5 id="​tests-​-​-测试文件-349个文件" tabindex="-1"><strong>​<code>tests/</code>​</strong> ​ <strong>- 测试文件</strong> (349个文件) <a class="header-anchor" href="#​tests-​-​-测试文件-349个文件" aria-label="Permalink to &quot;**​`tests/`​** ​  **- 测试文件** (349个文件)&quot;">​</a></h5><p>• <code>unit_tests/</code>​ - 单元测试<br> • <code>integration_tests/</code> - 集成测试</p><p><strong>其他重要目录</strong></p><p>• <code>constants/</code>​ - 常量定义<br> • <code>contexts/</code>​ - 上下文管理<br> • <code>fields/</code>​ - 字段定义<br> • <code>factories/</code>​ - 工厂模式<br> • <code>libs/</code>​ - 工具库<br> • <code>repositories/</code>​ - 数据访问层<br> • <code>schedule/</code>​ - 定时任务<br> • <code>storage/</code>​ - 存储实现<br> • <code>templates/</code> - HTML模板</p><p>🏛️ <strong>架构特点</strong></p><ol><li>分层架构: Controller → Service → Model 的经典三层架构</li><li>领域驱动设计: core/目录按业务领域组织</li><li>事件驱动: 使用事件系统处理业务逻辑</li><li>异步处理: 大量使用Celery进行异步任务处理</li><li>插件化: 支持插件扩展</li><li>多存储支持: 支持多种云存储和向量数据库</li></ol><p>🎯 <strong>1. API控制器层 (Controllers Layer)</strong></p><p>作用: 处理HTTP请求，负责路由、参数验证、权限检查和响应格式化<br> 职责:<br> • 接收HTTP请求<br> • 参数解析和验证<br> • 权限验证<br> • 调用服务层<br> • 返回HTTP响应</p><p>接口举例:</p><pre><code> 1 │# api/controllers/web/completion.py  
 2 │class CompletionApi(WebApiResource):  
 3 │    def post(self, app_id):  
 4 │        &quot;&quot;&quot;创建文本生成应用的完成消息&quot;&quot;&quot;  
 5 │        # 1. 解析请求参数  
 6 │        args = completion_parser.parse_args()  
 7 │  
 8 │        # 2. 获取应用模型  
 9 │        app_model = AppService.get_app(app_id)  
10 │  
11 │        # 3. 调用服务层  
12 │        return AppGenerateService.generate(  
13 │            app_model=app_model,  
14 │            user=current_user,  
15 │            args=args,  
16 │            invoke_from=InvokeFrom.WEB_APP  
17 │        )
</code></pre><p>路由配置:</p><pre><code> 1 │# api/controllers/web/__init__.py  
 2 │api.add_resource(CompletionApi, &quot;/completion-messages&quot;,  
   │endpoint=&quot;completion&quot;)
</code></pre><p>🔧 <strong>2. 业务服务层 (Services Layer)</strong></p><p>作用: 处理业务逻辑，协调多个核心组件，管理事务<br> 职责:<br> • 业务规则验证<br> • 事务管理<br> • 调用核心业务逻辑<br> • 数据转换<br> • 错误处理</p><p>接口举例:</p><pre><code> 1 │# api/services/app_generate_service.py  
 2 │class AppGenerateService:  
 3 │    @classmethod  
 4 │    def generate(cls, app_model: App, user: Account, args: dict,  
   │invoke_from: InvokeFrom):  
 5 │        &quot;&quot;&quot;应用内容生成服务&quot;&quot;&quot;  
 6 │        # 1. 业务规则验证 - 限流检查  
 7 │        if cls.system_rate_limiter.is_rate_limited(app_model.tenant_id):  
 8 │            raise InvokeRateLimitError(&quot;Rate limit exceeded&quot;)  
 9 │  
10 │        # 2. 根据应用模式选择生成器  
11 │        if app_model.mode == AppMode.COMPLETION.value:  
12 │            generator = CompletionAppGenerator()  
13 │        elif app_model.mode == AppMode.CHAT.value:  
14 │            generator = ChatAppGenerator()  
15 │        elif app_model.mode == AppMode.WORKFLOW.value:  
16 │            generator = WorkflowAppGenerator()  
17 │  
18 │        # 3. 调用核心业务逻辑  
19 │        return generator.generate(  
20 │            app_model=app_model,  
21 │            user=user,  
22 │            args=args,  
23 │            invoke_from=invoke_from  
24 │        )
</code></pre><p>🧠 <strong>3. 核心业务逻辑层 (Core Layer)</strong></p><p>作用: 实现核心业务算法和逻辑，处理复杂的业务场景<br> 职责:<br> • 核心算法实现<br> • 业务规则执行<br> • 模型调用<br> • 数据处理<br> • 工作流执行</p><p>接口举例:</p><pre><code> 1 │# api/core/app/apps/base_app_runner.py  
 2 │class AppRunner:  
 3 │    def generate(self, app_model: App, user: Account, args: dict) -&gt;  
   │Generator:  
 4 │        &quot;&quot;&quot;应用运行器 - 核心业务逻辑&quot;&quot;&quot;  
 5 │        # 1. 获取模型配置  
 6 │        model_config = self._get_model_config(app_model)  
 7 │  
 8 │        # 2. 构建提示词  
 9 │        prompt_messages = self._build_prompt_messages(args)  
10 │  
11 │        # 3. 调用LLM模型  
12 │        model_instance = ModelInstance(  
13 │            provider_model_bundle=model_config.provider_model_bundle,  
14 │            model=model_config.model  
15 │        )  
16 │  
17 │        # 4. 执行生成  
18 │        result = model_instance.invoke_llm(  
19 │            prompt_messages=prompt_messages,  
20 │            model_config=model_config  
21 │        )  
22 │  
23 │        # 5. 返回结果流  
24 │        yield from self._format_result_stream(result)
</code></pre><p>工作流引擎示例:</p><pre><code> 1 │# api/core/workflow/graph_engine/graph_engine.py  
 2 │class GraphEngine:  
 3 │    def run_workflow(self, workflow: Workflow, inputs: dict) -&gt; Generator:  
 4 │        &quot;&quot;&quot;工作流执行引擎&quot;&quot;&quot;  
 5 │        # 1. 构建执行图  
 6 │        execution_graph = self._build_execution_graph(workflow)  
 7 │  
 8 │        # 2. 执行节点  
 9 │        for node in execution_graph.nodes:  
10 │            result = self._execute_node(node, inputs)  
11 │            yield result  
12 │  
13 │        # 3. 返回最终结果  
14 │        return self._get_final_result(execution_graph)
</code></pre><p>🗄️ <strong>4. 数据模型层 (Models Layer)</strong></p><p>作用: 定义数据库实体和关系，提供数据访问接口<br> 职责:<br> • 数据库表结构定义<br> • 实体关系映射<br> • 数据验证<br> • 查询接口</p><p>接口举例:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># api/models/model.py</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tablename</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;apps&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Mapped[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(StringUUID, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">primary_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    tenant_id: Mapped[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(StringUUID)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    name: Mapped[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    mode: Mapped[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># completion, chat,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       │workflow</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    status: Mapped[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    created_at: Mapped[datetime] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(DateTime)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 关系定义</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> relationship(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">back_populates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    14</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    conversations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> relationship(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Conversation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">back_populates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    17</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tablename</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;messages&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    19</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: Mapped[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(StringUUID, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">primary_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    app_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(StringUUID, ForeignKey(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;apps.id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    21</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    conversation_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(StringUUID,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       │ForeignKey(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conversations.id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    22</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    query: Mapped[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(Text)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    23</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    answer: Mapped[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(Text)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    24</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    created_at: Mapped[datetime] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapped_column(DateTime)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    26</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 关系定义</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    27</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    app </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> relationship(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;App&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">back_populates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>‍</p><p>🔄 <strong>四层协作流程示例</strong></p><p>以&quot;用户发送消息到聊天应用&quot;为例：</p><ol><li><p><strong>Controller层</strong> - 接收请求</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># POST /api/chat-messages</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, app_id):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    args </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chat_parser.parse_args()  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 解析参数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    app_model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AppService.get_app(app_id)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取应用</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AppGenerateService.generate(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 调用服务层</span></span></code></pre></div></li><li><p><strong>Service层</strong> - 业务逻辑协调</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(app_model, user, args):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 限流检查</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rate_limiter.is_rate_limited(user.id):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │        </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">raise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RateLimitError()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 调用核心层</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    generator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatAppGenerator()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generator.generate(app_model, user, args)</span></span></code></pre></div></li><li><p><strong>Core层</strong> - 核心业务执行</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(app_model, user, args):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 构建提示词</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    prompt_messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> build_prompt(args)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 调用LLM</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    model_instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ModelInstance(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model_instance.invoke_llm(prompt_messages)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保存消息到数据库</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Message(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │        </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">app_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app_model.id,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │        </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;query&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │        </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.answer</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">14</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    )</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    db.session.add(message)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    db.session.commit()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">17</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span></span></code></pre></div></li><li><p><strong>Model层</strong> - 数据持久化</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SQLAlchemy自动处理数据库操作</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Message(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建实体</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │db.session.add(message)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加到会话</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │db.session.commit()      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 提交到数据库</span></span></code></pre></div></li></ol><p>📊 <strong>架构优势</strong></p><ol><li>职责分离: 每层专注自己的职责</li><li>可测试性: 每层可以独立测试</li><li>可维护性: 修改一层不影响其他层</li><li>可扩展性: 可以轻松添加新功能</li><li>复用性: 核心逻辑可以被多个控制器复用</li></ol><p>这种分层架构使得Dify能够处理复杂的AI应用场景，同时保持代码的清晰和可维护性。</p></div></div></main><footer class="VPDocFooter" data-v-28ef3a16 data-v-3fa11a47><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-3fa11a47><span class="visually-hidden" id="doc-footer-aria-label" data-v-3fa11a47>Pager</span><div class="pager" data-v-3fa11a47><a class="VPLink link pager-link prev" href="/Dify/docker-compose.yml" data-v-3fa11a47><!--[--><span class="desc" data-v-3fa11a47>Previous page</span><span class="title" data-v-3fa11a47>Docker-Compose.yml参数详解</span><!--]--></a></div><div class="pager" data-v-3fa11a47><a class="VPLink link pager-link next" href="/Dify/Web%E5%90%84%E4%B8%AA%E7%9B%AE%E5%BD%95%E7%9A%84%E5%8A%9F%E8%83%BD.html" data-v-3fa11a47><!--[--><span class="desc" data-v-3fa11a47>Next page</span><span class="title" data-v-3fa11a47>Web各个目录的功能</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"database_mongodb入门.md\":\"D7fNvdUQ\",\"database_mongodb进阶.md\":\"Z7odX5gJ\",\"database_python操作mongodb.md\":\"B6G2kdmo\",\"database_redis入门.md\":\"BM2atUZw\",\"database_redis应用.md\":\"CeoHWNaL\",\"database_redis的数据结构解析.md\":\"oLT1nNfG\",\"devops_devops实战.md\":\"CiHI46La\",\"devops_docker入门.md\":\"ChYHo4iC\",\"devops_docs_elk.md\":\"ZiYf5zbf\",\"devops_docs_jenkinsfile.md\":\"CS7sicDr\",\"devops_jeager入门.md\":\"C4cNpnHs\",\"devops_jenkins入门.md\":\"dhxJbdbT\",\"devops_kubernets概念.md\":\"CdNkg-nv\",\"devops_kubernets运维管理.md\":\"CnzKapnu\",\"devops_kubernets进阶.md\":\"DJ_5LtUg\",\"devops_prometheus入门.md\":\"CJWlV8FZ\",\"devops_入门.md\":\"CCxcQucQ\",\"dify_api各个目录文件功能.md\":\"zOWkhAfu\",\"dify_dify.md\":\"CTkWidf3\",\"dify_docker-compose.yml.md\":\"5HlZrPgl\",\"dify_embedding模型分段.md\":\"BPpVv1ws\",\"dify_web各个目录的功能.md\":\"BHrmiRn_\",\"dify_模型参数.md\":\"gR0GeUNJ\",\"index.md\":\"CqAHd1LE\",\"microservice_grpc入门.md\":\"DuW8-RTw\",\"microservice_jaeger使用指南.md\":\"DgBHzeU-\",\"microservice_jenkis使用指南.md\":\"Dlbx5kZy\",\"microservice_服务注册与发现.md\":\"75iCeOzi\",\"microservice_网关.md\":\"BPxZsDPw\",\"microservice_配置中心.md\":\"TXmFd4Qw\",\"python_gil锁.md\":\"CBOQDdWc\",\"python_内存管理.md\":\"DxLIBhw-\",\"python_多进程多线程协程.md\":\"DqTDNnZQ\",\"python_正则表达式.md\":\"Cxw7suLD\",\"python_装饰器.md\":\"CV9IUg5k\",\"python_迭代.md\":\"O6qBbaIz\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Young-Site\",\"description\":\"知行合一\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"Young-Blog\",\"logo\":\"/public/logo.jpeg\",\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Python\",\"link\":\"/Python/迭代\"},{\"text\":\"数据库\",\"link\":\"/Database/Redis入门\"},{\"text\":\"微服务\",\"link\":\"/MicroService/gRPC入门\"},{\"text\":\"DevOps\",\"link\":\"/DevOps/入门\"},{\"text\":\"Dify\",\"link\":\"/Dify/Dify\"}],\"sidebar\":{\"/Python/\":[{\"text\":\"Python\",\"items\":[{\"text\":\"可迭代对象、迭代器、生成器\",\"link\":\"/Python/迭代\"},{\"text\":\"多进程多线程协程\",\"link\":\"/Python/多进程多线程协程\"},{\"text\":\"正则表达式\",\"link\":\"/Python/正则表达式\"},{\"text\":\"GiL\",\"link\":\"/Python/GIL锁\"},{\"text\":\"装饰器\",\"link\":\"/Python/装饰器\"}]}],\"/Database/\":[{\"text\":\"数据库\",\"items\":[{\"text\":\"Redis入门\",\"link\":\"/Database/Redis入门\"},{\"text\":\"Redis应用\",\"link\":\"/Database/Redis应用\"},{\"text\":\"Redis的数据结构解析\",\"link\":\"/Database/Redis的数据结构解析\"},{\"text\":\"MongoDB入门\",\"link\":\"/Database/MongoDB入门\"},{\"text\":\"Python操作MongoDB\",\"link\":\"/Database/Python操作MongoDB\"},{\"text\":\"MongoDB进阶\",\"link\":\"/Database/MongoDB进阶\"}]}],\"/MicroService/\":[{\"text\":\"微服务基础\",\"items\":[{\"text\":\"gRPC入门\",\"link\":\"/MicroService/gRPC入门\"},{\"text\":\"服务注册与发现\",\"link\":\"/MicroService/服务注册与发现\"},{\"text\":\"配置中心\",\"link\":\"/MicroService/配置中心\"},{\"text\":\"网关\",\"link\":\"/MicroService/网关\"},{\"text\":\"jenkis使用指南\",\"link\":\"/MicroService/jenkis使用指南\"},{\"text\":\"jaeger使用指南\",\"link\":\"/MicroService/jaeger使用指南\"}]}],\"/DevOps/\":[{\"text\":\"DevOps\",\"items\":[{\"text\":\"入门\",\"link\":\"/DevOps/入门\"},{\"text\":\"Docker入门\",\"link\":\"/DevOps/Docker入门\"},{\"text\":\"Jenkins入门\",\"link\":\"/DevOps/Jenkins入门\"},{\"text\":\"Jeager入门\",\"link\":\"/DevOps/Jeager入门\"},{\"text\":\"Prometheus入门\",\"link\":\"/DevOps/Prometheus入门\"},{\"text\":\"Kubernets概念\",\"link\":\"/DevOps/Kubernets概念\"},{\"text\":\"Kubernets进阶\",\"link\":\"/DevOps/Kubernets进阶\"},{\"text\":\"Kubernets运维管理\",\"link\":\"/DevOps/Kubernets运维管理\"},{\"text\":\"DevOps实战\",\"link\":\"/DevOps/DevOps实战\"}]}],\"/Dify/\":[{\"text\":\"Dify\",\"items\":[{\"text\":\"Dify入门\",\"link\":\"/Dify/Dify\"},{\"text\":\"Docker-Compose.yml参数详解\",\"link\":\"/Dify/docker-compose.yml\"},{\"text\":\"API各个目录文件功能\",\"link\":\"/Dify/API各个目录文件功能\"},{\"text\":\"Web各个目录的功能\",\"link\":\"/Dify/Web各个目录的功能\"},{\"text\":\"Embedding模型分段\",\"link\":\"/Dify/Embedding模型分段\"},{\"text\":\"模型参数\",\"link\":\"/Dify/模型参数\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/zy30651\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>