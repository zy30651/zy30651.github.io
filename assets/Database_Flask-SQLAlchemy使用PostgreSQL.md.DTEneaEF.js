import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.B-XtCDNB.js";const y=JSON.parse('{"title":"Flask-SQLAlchemyä½¿ç”¨PostgreSQL","description":"","frontmatter":{},"headers":[],"relativePath":"Database/Flask-SQLAlchemyä½¿ç”¨PostgreSQL.md","filePath":"Database/Flask-SQLAlchemyä½¿ç”¨PostgreSQL.md"}'),h={name:"Database/Flask-SQLAlchemyä½¿ç”¨PostgreSQL.md"};function k(p,s,t,e,r,E){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="flask-sqlalchemyä½¿ç”¨postgresql" tabindex="-1">Flask-SQLAlchemyä½¿ç”¨PostgreSQL <a class="header-anchor" href="#flask-sqlalchemyä½¿ç”¨postgresql" aria-label="Permalink to &quot;Flask-SQLAlchemyä½¿ç”¨PostgreSQL&quot;">â€‹</a></h1><h3 id="å®‰è£…ä¾èµ–" tabindex="-1">å®‰è£…ä¾èµ– <a class="header-anchor" href="#å®‰è£…ä¾èµ–" aria-label="Permalink to &quot;å®‰è£…ä¾èµ–&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flask</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flask-sqlalchemy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> psycopg2-binary</span></span></code></pre></div><p>ï¼ˆ<code>psycopg2-binary</code> æ˜¯ PostgreSQL çš„ Python é©±åŠ¨ï¼‰</p><h3 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1">ä½¿ç”¨ç¤ºä¾‹ <a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹" aria-label="Permalink to &quot;ä½¿ç”¨ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Flask</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flask_sqlalchemy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SQLAlchemy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Flask(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__name__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é…ç½®æ•°æ®åº“è¿æ¥ï¼ˆPostgreSQLï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.config[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SQLALCHEMY_DATABASE_URI&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;postgresql://myuser:mypassword@localhost:5432/mydb&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.config[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SQLAlchemy(app)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®šä¹‰æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.Column(db.Integer, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">primary_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.Column(db.String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">unique</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">nullable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆå§‹åŒ–æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app.app_context():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    db.create_all()  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºè¡¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¤ºä¾‹è·¯ç”±</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@app.route</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    u </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> User.query.first()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">u.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;World&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">!&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    app.run(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">debug</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><hr><p>ğŸ‘‰ æ€»ç»“ï¼š</p><ul><li>PostgreSQL ä½¿ç”¨æ—¶ä¸»è¦é  <code>psql</code> å·¥å…·æˆ– ORMï¼ˆå¦‚ SQLAlchemyï¼‰ã€‚</li><li>Flask-SQLAlchemy å¯ä»¥ç›´æ¥æ”¯æŒ PostgreSQLï¼Œåªéœ€è¦é…ç½®å¥½ <code>SQLALCHEMY_DATABASE_URI</code></li></ul><p>â€</p><p>åŒºåˆ«</p><ol><li><p>æŸ¥è¯¢å¯¹è±¡çš„æ¥æºï¼š</p><ul><li>User.query.first()ï¼šè¿™æ˜¯é€šè¿‡æ¨¡å‹ç±»ä¸Šçš„ query å±æ€§è¿›è¡ŒæŸ¥è¯¢ã€‚User æ˜¯ä¸€ä¸ª SQLAlchemy æ¨¡å‹ç±»ï¼Œå®ƒé€šè¿‡ db.Model<br> ç»§æ‰¿ã€‚query æ˜¯ Flask-SQLAlchemy æä¾›çš„ä¸€ä¸ªä¾¿æ·å±æ€§ï¼Œå…è®¸ç›´æ¥åœ¨æ¨¡å‹ç±»ä¸Šæ„å»ºæŸ¥è¯¢ã€‚</li><li>db.session.query(AppMCPServer).where(...).first()ï¼šè¿™æ˜¯ä½¿ç”¨ SQLAlchemy çš„ Session<br> å¯¹è±¡è¿›è¡ŒæŸ¥è¯¢ã€‚db.session æ˜¯ SQLAlchemy çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæä¾›äº†å¯¹æ•°æ®åº“ä¼šè¯çš„è®¿é—®ï¼Œå…è®¸æ‰§è¡Œæ›´å¤æ‚çš„æŸ¥è¯¢æ“ä½œã€‚</li></ul></li><li><p>æŸ¥è¯¢çµæ´»æ€§ï¼š</p><ul><li>User.queryï¼šé€‚ç”¨äºç®€å•æŸ¥è¯¢ï¼Œé€šå¸¸ç”¨äºç›´æ¥ä¸æ¨¡å‹ç›¸å…³çš„åŸºæœ¬æ“ä½œã€‚</li><li>db.session.queryï¼šæä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œå…è®¸æ„å»ºæ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œå¦‚è¿æ¥ã€æ¡ä»¶ã€èšåˆç­‰ã€‚</li></ul></li><li><p>Flask-SQLAlchemy vs SQLAlchemyï¼š</p><ul><li>User.queryï¼šè¿™æ˜¯ Flask-SQLAlchemy çš„ç‰¹æ€§ï¼Œç®€åŒ–äº†æ¨¡å‹çš„æŸ¥è¯¢æ“ä½œã€‚</li><li>db.session.queryï¼šè¿™æ˜¯ SQLAlchemy çš„åŸç”Ÿç‰¹æ€§ï¼Œé€‚ç”¨äºæ²¡æœ‰ Flask æ‰©å±•çš„çº¯ SQLAlchemy<br> åº”ç”¨ï¼Œæˆ–è€…éœ€è¦æ›´åº•å±‚æ§åˆ¶çš„åº”ç”¨ã€‚</li></ul></li></ol><p>ç¤ºä¾‹æ¨¡å‹</p><p>è®©æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªç®€å•çš„æ¨¡å‹ç”¨äºæ¼”ç¤ºï¼š</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flask_sqlalchemy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SQLAlchemy</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SQLAlchemy()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     **</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tablename</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;users&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.Column(db.Integer, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">primary_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     username </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.Column(db.String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">unique</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">nullable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     email </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.Column(db.String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">unique</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">nullable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AppMCPServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     **</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tablename</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;app_mcp_servers&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.Column(db.Integer, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">primary_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">14</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     app_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.Column(db.String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">nullable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     server_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.Column(db.String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">nullable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>åŠŸèƒ½ç›¸åŒçš„æŸ¥è¯¢å†™æ³•</p><p>å‡è®¾æˆ‘ä»¬è¦æŸ¥è¯¢ User è¡¨çš„ç¬¬ä¸€ä¸ªè®°å½•å’Œ AppMCPServer è¡¨ä¸­ app_id ç­‰äºæŸä¸ªå€¼çš„ç¬¬ä¸€ä¸ªè®°å½•ã€‚</p><ol><li>æŸ¥è¯¢ User è¡¨çš„ç¬¬ä¸€ä¸ªè®°å½•</li></ol><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ Flask-SQLAlchemy çš„ä¾¿æ·æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">u </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> User.query.first()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ SQLAlchemy çš„ Session æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">u </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.session.query(User).first()</span></span></code></pre></div><ol start="2"><li>æŸ¥è¯¢ AppMCPServer è¡¨ä¸­ app_id ç­‰äºæŸä¸ªå€¼çš„ç¬¬ä¸€ä¸ªè®°å½•</li></ol><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ Flask-SQLAlchemy çš„ä¾¿æ·æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app_server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AppMCPServer.query</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                          .filter(AppMCPServer.app_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app_model.id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                          .first()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ SQLAlchemy çš„ Session æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app_server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.session.query(AppMCPServer)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .where(AppMCPServer.app_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app_model.id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .first()</span></span></code></pre></div><p>æ€»ç»“</p><ul><li>User.query.first() æ˜¯ Flask-SQLAlchemy æä¾›çš„ä¾¿æ·æ–¹æ³•ï¼Œé€‚ç”¨äºç®€å•çš„æŸ¥è¯¢æ“ä½œã€‚</li><li>db.session.query(...).first() æ˜¯ SQLAlchemy çš„åŸç”Ÿæ–¹æ³•ï¼Œæä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œé€‚ç”¨äºå¤æ‚çš„æŸ¥è¯¢æ“ä½œã€‚</li><li>åœ¨åŠŸèƒ½ç›¸åŒçš„æŸ¥è¯¢ä¸­ï¼Œä¸¤ç§å†™æ³•å¯ä»¥äº’æ¢ä½¿ç”¨ï¼Œå…·ä½“é€‰æ‹©å–å†³äºä»£ç é£æ ¼å’Œé¡¹ç›®éœ€æ±‚ã€‚</li></ul><h3 id="å¦‚æœåˆ‡æ¢æ•°æ®åº“pgsql-mysqlæˆ–è€…" tabindex="-1">å¦‚æœåˆ‡æ¢æ•°æ®åº“PGSql-&gt;Mysqlæˆ–è€… <a class="header-anchor" href="#å¦‚æœåˆ‡æ¢æ•°æ®åº“pgsql-mysqlæˆ–è€…" aria-label="Permalink to &quot;å¦‚æœåˆ‡æ¢æ•°æ®åº“PGSql-&gt;Mysqlæˆ–è€…&quot;">â€‹</a></h3><ul><li><p><strong>ä½¿ç”¨</strong> <strong>â€‹<code>db.session.query()</code>â€‹</strong> â€‹ <strong>æˆ–</strong> <strong>â€‹<code>db.query()</code>â€‹</strong></p><ul><li>åˆ‡æ¢æ•°æ®åº“ï¼ˆPostgreSQL â†” MySQL â†” SQLiteï¼‰æ—¶ï¼Œåªéœ€ä¿®æ”¹è¿æ¥å­—ç¬¦ä¸²ï¼Œå‡ ä¹ä¸éœ€è¦æ”¹æŸ¥è¯¢è¯­å¥</li></ul></li><li><p><strong>åˆ‡æ¢æ¡†æ¶ï¼ˆFlask â†” FastAPIï¼‰</strong></p><ul><li>ä¸»è¦å·®åˆ«åœ¨ <strong>Session çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></li><li>Flask-SQLAlchemy è‡ªåŠ¨å¸®ä½ ç®¡ç† <code>scoped_session</code></li><li>FastAPI éœ€è¦è‡ªå·±é€šè¿‡ä¾èµ–æ³¨å…¥åˆ›å»ºã€yieldã€å…³é—­ session</li><li>å…·ä½“æŸ¥è¯¢ã€å¢åˆ æ”¹æŸ¥è¯­å¥æœ¬èº«ä¸ç”¨æ”¹</li></ul></li></ul><h5 id="é€šç”¨å†™æ³•" tabindex="-1">é€šç”¨å†™æ³• <a class="header-anchor" href="#é€šç”¨å†™æ³•" aria-label="Permalink to &quot;é€šç”¨å†™æ³•&quot;">â€‹</a></h5><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sqlalchemy.orm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> declarative_base, sessionmaker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sqlalchemy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> create_engine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Base </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> declarative_base()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">engine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> create_engine(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;postgresql+psycopg2://user:pass@localhost:5432/mydb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SessionLocal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionmaker(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">bind</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">engine)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    __tablename__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;user&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Column(Integer, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">primary_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Column(String(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é€šç”¨ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SessionLocal()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.query(User).first()</span></span></code></pre></div><p>â€</p>`,28)])])}const g=i(h,[["render",k]]);export{y as __pageData,g as default};
